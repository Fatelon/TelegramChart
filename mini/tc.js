class Po{constructor(t,i){this.x=t,this.y=i}}class Pa{constructor(t,i){this.left=t,this.right=i}}class In{constructor(t,i,e){this.left=t,this.right=i,this.step=e}isEqual(t){return this.left===t.left&&this.right===t.right&&this.step===t.step}}class Bo{constructor(t,i,e,s){this.top=t,this.right=i,this.bottom=e,this.left=s}getPair(t){return t?new Pa(this.left,this.right):new Pa(this.bottom,this.top)}}class U{static getMiddleInterval(t,i,e){return new In(t.left+(i.left-t.left)*e,t.right+(i.right-t.right)*e,t.step+(i.step-t.step)*e)}static getYBorderPair(t,i,e){const s=new Pa(Number.MAX_VALUE,Number.MIN_VALUE);return t.forEach((t,h)=>{i[e[h]].inUse&&(s.left=Math.min(Math.min(...t),s.left),s.right=Math.max(Math.max(...t),s.right))}),s}static drawChartLine(t,i,e,s,h,a,n,o){0!==n&&(t.lineWidth=a,t.lineCap="round",t.strokeStyle=h,t.beginPath(),t.globalAlpha=n,i.forEach((i,s)=>{e.length>s&&t.lineTo(i,e[s])}),t.stroke(),null!==o&&(t.beginPath(),t.fillStyle=s,t.arc(i[o],e[o],5,0,2*Math.PI),t.fill(),t.arc(i[o],e[o],5,0,2*Math.PI),t.fill(),t.stroke()),t.globalAlpha=1)}static formatDate(t,i){const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=t.getDate();let a=e[t.getMonth()]+" "+h;if(1===i){const i=t.getDay();a=s[i]+", "+a}return a}static getScale(t,i){return Math.abs(i.right-i.left)/Math.abs(t.right-t.left)}static isPointInFrame(t,i){return!(t.x<i.left||t.x>i.right||t.y<i.bottom||t.y>i.top)}static getInterval(t,i){const e=(t.right-t.left)/(i-1),s=[1,1.5,2,2.5,5,7.5,10],h=Math.pow(10,-Math.floor(Math.log10(Math.abs(e)))),a=e*h,n=s.find(t=>t>=a),o=Number.parseInt((n/h).toFixed()),r=Math.ceil(t.right/o)*o,l=Math.floor(t.left/o)*o;return new In(l,r,o)}}class TC{constructor(t,i,e){this.init(t,i,e)}init(t,i,e){this.cx=null,this.canvas=null,this.width=Math.max(2*window.innerWidth/3,300),this.height=Math.max(3*window.innerHeight/5,200),this.xD=[],this.yAllData=[],this.limitedData=new Po([],[]),this.yIds={},this.yIdsKeys=[],this.lablesNumber=new Po(7,7),this.yPredInterval=new In(0,0,1),this.yNewInterval=new In(0,0,1),this.axeBoundInterval=new Po(new In(0,0,1),new In(0,0,1)),this.currentScale=new Po(1,1),this.animationFactor=new Po(1,1),this.currentAnimation=new Po(null,null),this.promptAnimation=null,this.xPredStep=0,this.yCurScale=0,this.yPredScale=0,this.frameDragType="",this.changeFrameAllowed=!1,this.minFrameWidth=this.width/100,this.predMousePoint=new Po(0,0),this.canvasMargin=new Bo(30,0,0,0),this.fBorderWidth=new Po(this.width/100,this.height/250),this.chartTitle=i,this.prepareData(t),this.initCanvas(),this.setMode(e)}prepareData(t){t.columns.forEach(i=>{const e=i.slice(0,1);const s=i.slice(1);"x"===t.types[e]?this.xD=s:"line"===t.types[e]&&(this.yIdsKeys.push(e),this.yIds[e]={inUse:!0,alpha:0,name:t.names[e],color:t.colors[e]},this.yAllData.push(s))})}initCanvas(){this.addBoard(),this.canvas.onmouseup=this.onMouseUp.bind(this),this.canvas.onmousedown=this.onMouseDown.bind(this),this.canvas.onmousemove=this.onMouseMove.bind(this),this.canvas.onmouseleave=this.onMouseLeave.bind(this),this.addMobile(),this.canvas.width=this.width,this.canvas.height=this.height,this.cx=this.canvas.getContext("2d"),this.cx.transform(1,0,0,-1,0,this.canvas.height);const t=.15*this.canvas.height;this.bigChartBoundaries=new Bo(this.canvas.height-this.canvasMargin.top,this.canvas.width-this.canvasMargin.right,this.canvasMargin.bottom+t+30,this.canvasMargin.left),this.smallChartBoundaries=new Bo(t+this.canvasMargin.bottom,this.canvas.width-this.canvasMargin.right,this.canvasMargin.bottom,this.canvasMargin.left),this.smallChartWidth=this.smallChartBoundaries.right-this.smallChartBoundaries.left,this.frameBoundaries=new Bo(this.smallChartBoundaries.top,this.smallChartBoundaries.left+.2*this.canvas.width,this.smallChartBoundaries.bottom,this.smallChartBoundaries.left)}addBoard(){this.prompt=document.getElementById("prompt"),this.pDate=document.getElementById("date"),this.pBody=document.getElementById("body");const t=document.getElementById("cc"),i=document.createElement("div");this.canvas=document.createElement("canvas"),this.bc=document.createElement("div"),this.bc.className="bp",i.style.width=this.width+"px",this.yIdsKeys.forEach(t=>{const i=document.createElement("label");const e=document.createElement("input");e.type="checkbox";e.style.backgroundColor=this.yIds[t].color;e.style.borderColor=this.yIds[t].color;e.setAttribute("checked","true");i.appendChild(e);i.innerHTML+=this.yIds[t].name;this.bc.appendChild(i);i.onchange=this.clickOnButton.bind(this,i,t);i.onselectstart=(()=>!1)});const e=document.createElement("h3");e.id=this.chartTitle,e.innerHTML=this.chartTitle,e.onselectstart=(()=>!1),e.style.textAlign="left",i.appendChild(e),i.appendChild(this.canvas),i.appendChild(this.bc),t.appendChild(i)}setMode(t){this.labelsTextFont1="lighter 9pt Helvetica",this.labelsTextFont2="lighter 18pt Helvetica",this.labelsTextColor="#96A2AA",this._frameColor=t?"#DDEAF3":"#40566B",this._outFrameColor=t?"#F5F9FB":"#1F2A38",this.backgroundColor=t?"#FFFFFF":"#242F3E",this.textColor=t?"#000000":"#FFFFFF",this.axesTextColor=t?"#96A2AA":"#546778",this.horizontalLinesColor=t?"#ECF0F3":"#313D4D",this.verticalLinesColor=t?"#DFE6EB":"#3B4A5A",document.body.style.backgroundColor=this.backgroundColor,this.prompt.style.background=t?"#FFFFFF":"#253241",this.prompt.style.borderColor=t?"#DFE6EB":"#202a37",this.prompt.style.boxShadow=t?"2px 2px 1px #DFE6EB":"2px 2px 1px #202a37",this.pDate.style.color=this.textColor,document.getElementById(this.chartTitle).style.color=this.textColor,this.bc.childNodes.forEach(t=>{t.style.color=this.textColor;t.style.borderColor=this.verticalLinesColor}),this.refreshView(!0)}refreshView(t,i){(t||i)&&this.calculateDataAndBoundaries(i),this.cx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBigChart(),this.cx.clearRect(0,0,this.smallChartBoundaries.right,this.smallChartBoundaries.top),this.drawSmallChart()}calculateDataAndBoundaries(t){const i=new Pa(this.frameBoundaries.left/this.smallChartWidth,this.frameBoundaries.right/this.smallChartWidth),e=this.xD[this.xD.length-1]-this.xD[0];this.axeBoundInterval.x.left=e*i.left+this.xD[0],this.axeBoundInterval.x.right=e*i.right+this.xD[0];let s=0,h=0;this.xD.forEach((t,i)=>{t<this.axeBoundInterval.x.left?s=i+1:t>this.axeBoundInterval.x.right||(h=i)});const a=0===this.xPredStep;for(;Math.ceil((h-s+1)/this.axeBoundInterval.x.step)>9;)this.xPredStep=this.axeBoundInterval.x.step,this.axeBoundInterval.x.step*=2,!a&&this.checkAndRunXAnimation();for(;5>Math.ceil((h-s+1)/this.axeBoundInterval.x.step);)this.xPredStep=this.axeBoundInterval.x.step,this.axeBoundInterval.x.step/=2,!a&&this.checkAndRunXAnimation();s=Math.max(s-1,0),h=Math.min(h+1,this.xD.length-1)+1,this.limitedData.x=this.xD.slice(s,h),this.limitedData.y=this.yAllData.map(t=>t.slice(s,h)),this.currentScale.x=U.getScale(this.axeBoundInterval.x,this.bigChartBoundaries.getPair(!0));const n=U.getYBorderPair(this.limitedData.y,this.yIds,this.yIdsKeys);let o=U.getInterval(n,this.lablesNumber.y);n.right<n.left&&(o=new In(10,10,1)),!t&&o.isEqual(this.yNewInterval)||(null!==this.currentAnimation.y&&(clearTimeout(this.currentAnimation.y),this.yPredInterval=this.yNewInterval),this.yNewInterval=o,this.runYAnimation(0,this))}runYAnimation(t,i){(t+=.1)>1?(i.yCalculateMiddleIntervalAndRefrash(1),clearTimeout(i.currentAnimation.y),i.currentAnimation.y=null):(i.yCalculateMiddleIntervalAndRefrash(t),i.currentAnimation.y=setTimeout(i.runYAnimation,15,t,i))}yCalculateMiddleIntervalAndRefrash(t){this.yIdsKeys.forEach(i=>{this.yIds[i].inUse&&1>this.yIds[i].alpha&&(this.yIds[i].alpha=t);!this.yIds[i].inUse&&this.yIds[i].alpha>0&&(this.yIds[i].alpha=1-t)}),1===t?(this.yPredInterval=this.yNewInterval,this.axeBoundInterval.y=this.yNewInterval):this.axeBoundInterval.y=U.getMiddleInterval(this.yPredInterval,this.yNewInterval,t),this.animationFactor.y=t,this.currentScale.y=U.getScale(this.axeBoundInterval.y,this.bigChartBoundaries.getPair(!1)),this.refreshView(!1)}checkAndRunXAnimation(){null!==this.currentAnimation.x&&clearTimeout(this.currentAnimation.x),this.runXAnimation(0)}runXAnimation(t){t+=.1,this.animationFactor.x=Math.min(t,1),t>1?(this.animationFactor.x=1,this.xPredStep=this.axeBoundInterval.x.step,clearTimeout(this.currentAnimation.x),this.currentAnimation.x=null,null===this.currentAnimation.y&&this.refreshView(!1)):(null===this.currentAnimation.y&&this.refreshView(!1),this.currentAnimation.x=setTimeout(this.runXAnimation.bind(this),15,t))}drawBigChart(){if(this.yNewInterval.left===this.yNewInterval.right)return void this.drawNoDataText();1!==this.animationFactor.y&&this.drawHorizontalLines(this.yPredInterval,1-this.animationFactor.y),this.drawHorizontalLines(this.yNewInterval,this.animationFactor.y);const t=this.limitedData.x.map(t=>(t-this.axeBoundInterval.x.left)*this.currentScale.x+this.bigChartBoundaries.left),i=this.drawVerticalLine(t);this.limitedData.y.forEach((e,s)=>{U.drawChartLine(this.cx,t,e.map(t=>(t-this.axeBoundInterval.y.left)*this.currentScale.y+this.bigChartBoundaries.bottom),this.backgroundColor,this.yIds[this.yIdsKeys[s]].color,3,this.yIds[this.yIdsKeys[s]].alpha,i)}),1!==this.animationFactor.y&&this.drawYScaleLabelsText(this.yPredInterval,1-this.animationFactor.y),this.drawYScaleLabelsText(this.yNewInterval,this.animationFactor.y),this.drawXScaleLabelsText()}drawNoDataText(){const t=this.canvas.height;this.cx.transform(1,0,0,-1,0,t),this.cx.globalAlpha=this.animationFactor.y,this.cx.fillStyle=this.labelsTextColor,this.cx.font=this.labelsTextFont2,this.cx.fillText("No data available",this.canvas.width/2-this.canvas.width/10,this.canvas.height/2),this.cx.transform(1,0,0,-1,0,t),this.cx.fill(),this.cx.stroke(),this.cx.globalAlpha=1}drawHorizontalLines(t,i){this.cx.beginPath(),this.cx.strokeStyle=this.horizontalLinesColor,this.cx.globalAlpha=i,this.cx.lineWidth=1;let e=0;for(;e<=t.right-t.left&&t.step>0;){const i=e*this.currentScale.y+this.bigChartBoundaries.bottom;this.cx.moveTo(this.bigChartBoundaries.left,i),this.cx.lineTo(this.bigChartBoundaries.right,i),e+=t.step}this.cx.stroke(),this.cx.globalAlpha=1}drawVerticalLine(t){if(!this.changeFrameAllowed&&U.isPointInFrame(this.predMousePoint,this.bigChartBoundaries)){let i=0;for(;Math.abs(t[i+1]-this.predMousePoint.x)<Math.abs(t[i]-this.predMousePoint.x)||this.bigChartBoundaries.left>t[i]&&this.bigChartBoundaries.right>=t[i];)i++;this.cx.beginPath(),this.cx.strokeStyle=this.verticalLinesColor,this.cx.lineWidth=1,this.cx.moveTo(t[i],this.bigChartBoundaries.top),this.cx.lineTo(t[i],this.bigChartBoundaries.bottom),this.cx.stroke();const e=(t[i]-this.bigChartBoundaries.left)/(this.bigChartBoundaries.right-this.bigChartBoundaries.left),s=Math.round(this.canvas.offsetLeft+t[i]-this.prompt.offsetWidth*e)+"px";return s===this.prompt.style.left&&this.prompt.style.opacity>0||(clearTimeout(this.promptAnimation),this.setPrompt(i),this.runPromptAnimation(0,.06)),this.prompt.style.left=s,this.prompt.style.top=this.canvas.offsetTop+this.canvas.height/20+"px",i}return this.prompt.style.opacity>0&&(clearTimeout(this.promptAnimation),this.prompt.style.opacity="0"),null}setPrompt(t){for(this.pDate.innerText=U.formatDate(new Date(this.limitedData.x[t]),1);this.pBody.firstChild;)this.pBody.removeChild(this.pBody.firstChild);this.yIdsKeys.forEach((i,e)=>{if(this.yIds[i].inUse){const s=document.createElement("div");s.style.color=this.yIds[i].color,s.innerText=this.yIds[i].name+":  "+this.limitedData.y[e][t],this.pBody.appendChild(s)}})}runPromptAnimation(t,i){t+=i,this.prompt.style.opacity=t+"",t>0&&1>t&&(this.promptAnimation=setTimeout(this.runPromptAnimation.bind(this),30,t,i))}drawYScaleLabelsText(t,i){const e=this.canvas.height;this.cx.transform(1,0,0,-1,0,e),this.cx.fillStyle=this.axesTextColor,this.cx.lineWidth=.2,this.cx.strokeStyle=this.axesTextColor,this.cx.font=this.labelsTextFont1;let s=0;for(;s<=t.right-t.left&&t.step>0;){const i=s*this.currentScale.y+this.bigChartBoundaries.bottom;this.cx.fillText(""+(t.left+s),this.bigChartBoundaries.left,e-i-.015*e),this.cx.strokeText(""+(t.left+s),this.bigChartBoundaries.left,e-i-.015*e),s+=t.step}this.cx.stroke(),this.cx.transform(1,0,0,-1,0,e)}drawXScaleLabelsText(){const t=this.canvas.height;this.cx.transform(1,0,0,-1,0,t),this.cx.fillStyle=this.axesTextColor,this.cx.strokeStyle=this.axesTextColor,this.cx.lineWidth=.2;let i=this.xPredStep<this.axeBoundInterval.x.step?1-this.animationFactor.x:this.animationFactor.x;const e=Math.min(this.xPredStep,this.axeBoundInterval.x.step);for(let s=0;s<=this.xD.length;s+=e){this.cx.globalAlpha=s/e%2==0?1:i;const h=this.xD[s],a=(h-this.axeBoundInterval.x.left)*this.currentScale.x+this.bigChartBoundaries.left;this.cx.strokeText(""+U.formatDate(new Date(h)),a,t-this.bigChartBoundaries.bottom+20),this.cx.fillText(""+U.formatDate(new Date(h)),a,t-this.bigChartBoundaries.bottom+20)}this.cx.stroke(),this.cx.globalAlpha=1,this.cx.transform(1,0,0,-1,0,t)}drawSmallChart(){const t=this.smallChartBoundaries.bottom+5,i=U.getYBorderPair(this.yAllData,this.yIds,this.yIdsKeys);let e=U.getScale(i,new Pa(t,this.smallChartBoundaries.top-5));this.yCurScale===e&&0!==this.yPredScale||(this.yPredScale=this.yCurScale),this.yCurScale=e;const s=U.getScale(new Pa(this.xD[0],this.xD[this.xD.length-1]),this.smallChartBoundaries),h=this.xD.map(t=>(t-this.xD[0])*s+this.smallChartBoundaries.left);this.yNewInterval.left!==this.yNewInterval.right&&this.yAllData.forEach((s,a)=>{let n=e;!this.yIds[this.yIdsKeys[a]].inUse&&1>this.yIds[this.yIdsKeys[a]].alpha&&(n=this.yPredScale);U.drawChartLine(this.cx,h,s.map(e=>(e-i.left)*n+t),this.backgroundColor,this.yIds[this.yIdsKeys[a]].color,1,this.yIds[this.yIdsKeys[a]].alpha,null)}),this.drawFrame()}drawFrame(){const t=this.fBorderWidth.x,i=this.fBorderWidth.y;this.cx.strokeStyle=this._frameColor,this.cx.globalAlpha=.6,this.cx.beginPath(),this.cx.lineCap="butt",this.cx.lineWidth=i,this.cx.moveTo(this.frameBoundaries.left,this.frameBoundaries.top-i/2),this.cx.lineTo(this.frameBoundaries.right,this.frameBoundaries.top-i/2),this.cx.moveTo(this.frameBoundaries.right,this.frameBoundaries.bottom+i/2),this.cx.lineTo(this.frameBoundaries.left,this.frameBoundaries.bottom+i/2),this.cx.stroke(),this.cx.beginPath(),this.cx.lineWidth=t,this.cx.moveTo(this.frameBoundaries.left+t/2,this.frameBoundaries.bottom+i),this.cx.lineTo(this.frameBoundaries.left+t/2,this.frameBoundaries.top-i),this.cx.moveTo(this.frameBoundaries.right-t/2,this.frameBoundaries.top-i),this.cx.lineTo(this.frameBoundaries.right-t/2,this.frameBoundaries.bottom+i),this.cx.stroke(),this.cx.fillStyle=this._outFrameColor,this.cx.fillRect(this.smallChartBoundaries.left,this.smallChartBoundaries.bottom,this.frameBoundaries.left-this.smallChartBoundaries.left,this.frameBoundaries.top-this.smallChartBoundaries.bottom),this.cx.fillRect(this.frameBoundaries.right,this.frameBoundaries.bottom,this.smallChartBoundaries.right-this.frameBoundaries.right,this.frameBoundaries.top-this.smallChartBoundaries.bottom),this.cx.globalAlpha=1}clickOnButton(t,i){this.yIds[i].inUse=!this.yIds[i].inUse,t.childNodes[0].style.backgroundColor=this.yIds[i].inUse?this.yIds[i].color:this.backgroundColor,this.refreshView(!0,!0)}onMouseUp(t){this.changeFrameAllowed=!1}onMouseDown(t){const i=t.target.getBoundingClientRect(),e=new Po(t.clientX-i.left,i.bottom-t.clientY);U.isPointInFrame(e,this.smallChartBoundaries)?(this.changeFrameAllowed=!0,this.predMousePoint=e,e.x<this.frameBoundaries.left+this.fBorderWidth.x?this.frameDragType="left":e.x>this.frameBoundaries.right-this.fBorderWidth.x?this.frameDragType="right":this.frameDragType="center"):this.changeFrameAllowed=!1}onMouseMove(t){const i=t.target.getBoundingClientRect(),e=new Po(t.clientX-i.left,i.bottom-t.clientY);if(e.x!==this.predMousePoint.x){if(U.isPointInFrame(e,this.smallChartBoundaries)?this.canvas.style.cursor="col-resize":this.canvas.style.cursor="default",this.changeFrameAllowed){const t=e.x-this.predMousePoint.x;if("left"===this.frameDragType){const i=Math.min(this.frameBoundaries.left+t,this.frameBoundaries.right-2*this.fBorderWidth.x-this.minFrameWidth);this.frameBoundaries.left=Math.max(this.smallChartBoundaries.left,i)}else if("right"===this.frameDragType){const i=Math.max(this.frameBoundaries.right+t,this.frameBoundaries.left+2*this.fBorderWidth.x+this.minFrameWidth);this.frameBoundaries.right=Math.min(this.smallChartBoundaries.right,i)}else"center"===this.frameDragType&&(this.frameBoundaries.left+t<this.smallChartBoundaries.left||this.frameBoundaries.right+t>this.smallChartBoundaries.right||(this.frameBoundaries.left+=t,this.frameBoundaries.right+=t))}this.predMousePoint=e,this.refreshView(!0)}}onMouseLeave(t){const i=t.target.getBoundingClientRect();this.predMousePoint=new Po(t.clientX-i.left,i.bottom-t.clientY),this.changeFrameAllowed=!1,this.refreshView(!0)}addMobile(){this.canvas.addEventListener("touchstart",function(t){const i=t.touches[0];this.canvas.dispatchEvent(new MouseEvent("mousedown",{clientX:i.clientX,clientY:i.clientY}))}.bind(this)),this.canvas.addEventListener("touchend",function(t){this.canvas.dispatchEvent(new MouseEvent("mouseup",{}))}.bind(this)),this.canvas.addEventListener("touchmove",function(t){this.canvas.dispatchEvent(new MouseEvent("mousemove",{clientX:t.touches[0].clientX,clientY:t.touches[0].clientY}))}.bind(this))}}let mode=!0,charts=[];changeMode=(()=>{mode=!mode;const t=document.getElementById("title");const i=document.getElementById("hb");const e=document.getElementById("swMode");mode?(t.style.color="#000000",e.innerText="To Night Mode",i.classList.remove("night"),i.classList.add("day")):(t.style.color="#FFFFFF",e.innerText="To Day Mode",i.classList.remove("day"),i.classList.add("night"));charts.forEach(t=>t.setMode(mode))});let jsonData=[];const xhr=new XMLHttpRequest;xhr.open("GET","/chart_data.json"),xhr.onreadystatechange=(t=>{xhr.readyState===XMLHttpRequest.DONE&&200===xhr.status&&(charts=[],(jsonData=JSON.parse(xhr.responseText)).forEach((t,i)=>charts.push(new TC(t,"Followers #"+(i+1),mode))))}),xhr.send(),resize=(t=>{const i=document.getElementById("cc");for(;i.firstChild;)i.removeChild(i.firstChild);charts=[];jsonData.forEach((t,i)=>charts.push(new TC(t,"Followers #"+(i+1),mode)))}),window.addEventListener("resize",resize);